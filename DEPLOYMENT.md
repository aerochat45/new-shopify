# Deployment Guide for Render

This guide will help you deploy your AeroChat Shopify App to Render.

## Prerequisites

1. **GitHub Repository**: Your code should be pushed to a GitHub repository
2. **Render Account**: Sign up at https://render.com
3. **Shopify Partner Account**: For app configuration
4. **AeroChat API Access**: For third-party integration

## Step-by-Step Deployment

### 1. Prepare Your Repository

Ensure your repository contains:
- ✅ `main.py` (Flask app entry point)
- ✅ `requirements.txt` (Python dependencies)
- ✅ `render.yaml` (Render configuration)
- ✅ `Procfile` (Alternative deployment config)
- ✅ `.gitignore` (Excludes sensitive files)
- ✅ `README.md` (Documentation)

### 2. Create Render Account and Connect GitHub

1. Go to https://render.com
2. Sign up using your GitHub account
3. Authorize Render to access your repositories

### 3. Deploy Using render.yaml (Recommended)

1. **Create New Web Service**
   - Click "New +" → "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect the `render.yaml` file

2. **Configure Environment Variables**
   After the service is created, go to Environment tab and set:
   ```
   SHOPIFY_API_KEY=your_shopify_api_key_here
   SHOPIFY_API_SECRET=your_shopify_api_secret_here
   SHOPIFY_REDIRECT_URI=https://your-app-name.onrender.com/oauth/callback
   SHOPIFY_APP_HANDLE=your-app-handle
   THIRD_PARTY_BASE=https://your-aerochat-api.com
   SECRET_KEY=your-random-secret-key-here
   ```

3. **Database Configuration**
   - The `render.yaml` will automatically create a PostgreSQL database
   - The `DATABASE_URL` will be automatically set

### 4. Alternative: Manual Deployment

If you prefer manual setup:

1. **Create Web Service**
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name**: `aerochat-shopify-app`
     - **Environment**: `Python 3`
     - **Build Command**: `pip install -r requirements.txt`
     - **Start Command**: `python main.py`

2. **Create Database**
   - Click "New +" → "PostgreSQL"
   - **Name**: `aerochat-db`
   - **Plan**: Free (or choose based on needs)

3. **Set Environment Variables**
   ```
   SHOPIFY_API_KEY=your_shopify_api_key_here
   SHOPIFY_API_SECRET=your_shopify_api_secret_here
   SHOPIFY_SCOPES=read_products,write_products,read_orders,write_orders
   SHOPIFY_REDIRECT_URI=https://your-app-name.onrender.com/oauth/callback
   SHOPIFY_APP_HANDLE=your-app-handle
   THIRD_PARTY_BASE=https://your-aerochat-api.com
   DATABASE_URL=postgresql://username:password@host:port/database
   SECRET_KEY=your-random-secret-key-here
   ```

### 5. Update Shopify App Configuration

1. **Go to Shopify Partner Dashboard**
   - Visit https://partners.shopify.com
   - Navigate to your app

2. **Update App URLs**
   - **App URL**: `https://your-app-name.onrender.com`
   - **Allowed redirection URLs**: `https://your-app-name.onrender.com/oauth/callback`

3. **Configure Webhooks**
   - **App uninstalled**: `https://your-app-name.onrender.com/webhooks/uninstall`
   - **Subscription updated**: `https://your-app-name.onrender.com/webhooks/subscription`

### 6. Test Your Deployment

1. **Check Service Status**
   - Go to your Render dashboard
   - Ensure the web service is "Live"

2. **Test Installation**
   - Use the Shopify app installation URL format:
   ```
   https://your-app-name.onrender.com/install?shop=your-shop.myshopify.com
   ```

3. **Monitor Logs**
   - Check the Render service logs for any errors
   - Verify database connections are working

## Environment Variables Reference

| Variable | Description | Example |
|----------|-------------|---------|
| `SHOPIFY_API_KEY` | Your Shopify app's API key | `9245b3af044f843540f65b7da58b6dca` |
| `SHOPIFY_API_SECRET` | Your Shopify app's API secret | `e043750d9bad8e80b92caf124f1dd2fa` |
| `SHOPIFY_SCOPES` | Required Shopify permissions | `read_products,write_products,read_orders,write_orders` |
| `SHOPIFY_REDIRECT_URI` | OAuth callback URL | `https://your-app.onrender.com/oauth/callback` |
| `SHOPIFY_APP_HANDLE` | Your app handle | `your-app-handle` |
| `THIRD_PARTY_BASE` | AeroChat API base URL | `https://aerochat-staging.dummywebdemo.xyz` |
| `DATABASE_URL` | PostgreSQL connection string | Auto-generated by Render |
| `SECRET_KEY` | Flask secret key | Generate a random string |

## Troubleshooting

### Common Issues

1. **Build Failures**
   - Check `requirements.txt` for correct package versions
   - Ensure all dependencies are listed

2. **Database Connection Errors**
   - Verify `DATABASE_URL` is correctly set
   - Check database service is running

3. **Shopify OAuth Issues**
   - Ensure redirect URI matches exactly
   - Verify API key and secret are correct

4. **Service Won't Start**
   - Check start command in Render dashboard
   - Review logs for error messages

### Getting Help

- Check Render documentation: https://render.com/docs
- Review application logs in Render dashboard
- Ensure all environment variables are set correctly

## Post-Deployment Checklist

- [ ] Web service is running and accessible
- [ ] Database is connected and tables created
- [ ] Shopify app URLs are updated
- [ ] Webhooks are configured
- [ ] App installation works from Shopify
- [ ] All environment variables are set
- [ ] Logs show no critical errors

## Scaling Considerations

- **Free Tier**: Limited to 750 hours/month
- **Paid Plans**: Better performance and reliability
- **Database**: Consider upgrading for production use
- **Monitoring**: Set up alerts for service health

Your app is now ready for production use on Render!
